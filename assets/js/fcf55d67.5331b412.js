"use strict";(self.webpackChunkdot_net_from_zero_by_soheil_karami=self.webpackChunkdot_net_from_zero_by_soheil_karami||[]).push([[5471],{5250:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"Contents/Session2/High\u2011Level Architecture","title":"High\u2011Level Architecture","description":"Important: The code snippets below are intentionally simplified.","source":"@site/docs/Contents/Session2/04-High\u2011Level Architecture.md","sourceDirName":"Contents/Session2","slug":"/Contents/Session2/High\u2011Level Architecture","permalink":"/DotNet-From-Zero-by-Soheil-Karami/docs/Contents/Session2/High\u2011Level Architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/sohilww/DotNet-From-Zero-by-Soheil-Karami/docs/Contents/Session2/04-High\u2011Level Architecture.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"High\u2011Level Architecture"},"sidebar":"tutorialSidebar","previous":{"title":"SOLID Principles","permalink":"/DotNet-From-Zero-by-Soheil-Karami/docs/Contents/Session2/SOLID-Principles"},"next":{"title":"DDD","permalink":"/DotNet-From-Zero-by-Soheil-Karami/docs/category/ddd"}}');var s=r(4848),t=r(8453);const l={title:"High\u2011Level Architecture"},d="High\u2011Level Architecture",c={},o=[{value:"\ud83d\udd39 Domain Layer \u2014 <em>The Heart</em>",id:"-domain-layer--the-heart",level:2},{value:"Responsibilities",id:"responsibilities",level:3},{value:"\ud83d\udd39 Application Layer \u2014 <em>The Brains</em>",id:"-application-layer--the-brains",level:2},{value:"Typical Artifacts",id:"typical-artifacts",level:3},{value:"\ud83d\udd39 Infrastructure Layer \u2014 <em>The Plumbing</em>",id:"-infrastructure-layer--the-plumbing",level:2},{value:"Patterns Used",id:"patterns-used",level:3},{value:"\ud83d\udd39 API\xa0/\xa0UI Layer \u2014 <em>The Window</em>",id:"-apiui-layer--the-window",level:2},{value:"\ud83d\udd39 Putting It All Together \u2014 Request Flow",id:"-putting-it-all-together--request-flow",level:2},{value:"Dependency Rule",id:"dependency-rule",level:3},{value:"\ud83e\uddf9 Clean Architecture Tips",id:"-clean-architecture-tips",level:2}];function a(e){const n={blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," The code snippets below are intentionally simplified.",(0,s.jsx)(n.br,{}),"\n","They are ",(0,s.jsx)(n.strong,{children:"not perfect designs"}),"; they exist only to illustrate concepts.",(0,s.jsx)(n.br,{}),"\n","As the course progresses, we will refactor and harden them into production\u2011ready patterns."]}),"\n"]}),"\n",(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"highlevel-architecture",children:"High\u2011Level Architecture"})}),"\n",(0,s.jsxs)(n.p,{children:["Designing a real\u2011world .NET application is ",(0,s.jsx)(n.strong,{children:"more than \u201cwhere do I put my files?\u201d"}),(0,s.jsx)(n.br,{}),"\n","A clear architectural boundary:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Separates concerns"})," \u2013 each layer owns one clear job."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Accelerates change"})," \u2013 teams work in parallel."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Improves testability"})," \u2013 pure logic is isolated from I/O."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["We\u2019ll use a ",(0,s.jsx)(n.strong,{children:"four\u2011layer architecture"})," diagram\u2014crafted by\xa0Soheil purely for teaching purposes (not a production recommendation)\u2014to make architectural boundaries easy to understand.(inspired by Clean Architecture and Union Architecture but simplified for beginners)."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"-domain-layer--the-heart",children:["\ud83d\udd39 Domain Layer \u2014 ",(0,s.jsx)(n.em,{children:"The Heart"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Hold core business rules, invariants, and ubiquitous language.",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Key idea:"})," \u201cNo framework talk allowed here.\u201d"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"responsibilities",children:"Responsibilities"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Item"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Entities"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"Order"}),", ",(0,s.jsx)(n.code,{children:"Customer"}),", ",(0,s.jsx)(n.code,{children:"Product"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Value Objects"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"Money"}),", ",(0,s.jsx)(n.code,{children:"Email"}),", ",(0,s.jsx)(n.code,{children:"Address"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Domain Services"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"PricingService"}),", ",(0,s.jsx)(n.code,{children:"TaxPolicy"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Business Events"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"OrderPlaced"}),", ",(0,s.jsx)(n.code,{children:"PaymentFailed"})]})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// Value Object: immutable & self\u2011validating\npublic class Email\n{\n    public string Value { get; }\n\n    private Email(string value) => Value = value;\n\n    public static Email Create(string value)\n    {\n        if (!Regex.IsMatch(value, @"^[^@\\s]+@[^@\\s]+\\.[^@\\s]+$"))\n            throw new ArgumentException("Invalid email");\n        return new Email(value);\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe8 ",(0,s.jsx)(n.strong,{children:"Questions for students"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Why shouldn\u2019t ",(0,s.jsx)(n.code,{children:"Email"})," know anything about Entity Framework or HTTP?"]}),"\n",(0,s.jsx)(n.li,{children:"What makes a Value Object different from an Entity?"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe6 ",(0,s.jsx)(n.strong,{children:"Practice"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Implement a ",(0,s.jsx)(n.code,{children:"Money"})," value object with ",(0,s.jsx)(n.code,{children:"Amount"}),"\u202f+\u202f",(0,s.jsx)(n.code,{children:"Currency"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Add validation so mismatched currencies can\u2019t be added."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"-application-layer--the-brains",children:["\ud83d\udd39 Application Layer \u2014 ",(0,s.jsx)(n.em,{children:"The Brains"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Coordinate use\u2011cases, orchestrate domain objects, enforce transactions."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"typical-artifacts",children:"Typical Artifacts"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Concept"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Commands"})}),(0,s.jsxs)(n.td,{children:["Verb\u202f+\u202fDTO intent (",(0,s.jsx)(n.code,{children:"PlaceOrderCommand"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Queries"})}),(0,s.jsxs)(n.td,{children:["Read\u2011only requests (",(0,s.jsx)(n.code,{children:"GetOrderByIdQuery"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Handlers"})}),(0,s.jsx)(n.td,{children:"Execute a command/query"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"DTOs / Mappers"})}),(0,s.jsx)(n.td,{children:"Shape data for API/UI, not for EF"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public class PlaceOrderCommand\n{\n    public int     OrderId { get; }\n    public decimal Price   { get; }\n\n    public PlaceOrderCommand(int orderId, decimal price)\n    {\n        OrderId = orderId;\n        Price   = price;\n    }\n}\n\npublic class PlaceOrderHandler\n{\n    private readonly IUnitOfWork uow;\n    private readonly IOrderRepository repo;\n\n    public PlaceOrderHandler(IUnitOfWork uow, IOrderRepository repo)\n    {\n        this.uow  = uow;\n        this.repo = repo;\n    }\n\n    public void Handle(PlaceOrderCommand cmd)\n    {\n        var order = repo.Get(cmd.OrderId);\n        order.AddItem(cmd.Price);\n        uow.Commit();                 // single transaction\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe8 ",(0,s.jsx)(n.strong,{children:"Questions for students"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["How many external concerns are referenced in ",(0,s.jsx)(n.code,{children:"PlaceOrderHandler"}),"?"]}),"\n",(0,s.jsxs)(n.li,{children:["What would break if ",(0,s.jsx)(n.code,{children:"AddItem"})," called ",(0,s.jsx)(n.code,{children:"Console.WriteLine"}),"?"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe6 ",(0,s.jsx)(n.strong,{children:"Practice"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Write a ",(0,s.jsx)(n.code,{children:"GetTotalOrdersQuery"})," that returns total sales for today, leveraging repositories only."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"-infrastructure-layer--the-plumbing",children:["\ud83d\udd39 Infrastructure Layer \u2014 ",(0,s.jsx)(n.em,{children:"The Plumbing"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Provide technical capabilities (DB, file, SMTP, HTTP clients) ",(0,s.jsx)(n.strong,{children:"without leaking"})," into Domain/Application."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"patterns-used",children:"Patterns Used"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Why?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Repository"})}),(0,s.jsx)(n.td,{children:"Hide data\u2011access details; expose aggregates."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Unit of Work"})}),(0,s.jsx)(n.td,{children:"Bundle writes into a single transaction."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Gateway"})}),(0,s.jsx)(n.td,{children:"Wrap external APIs (payment, email)."})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public class EfOrderRepository : IOrderRepository\n{\n    private readonly ShopDbContext db;\n    public EfOrderRepository(ShopDbContext db) => this.db = db;\n\n    public Order Get(int id)   => db.Orders.Find(id)!;\n    public void Save(Order o)  => db.SaveChanges();\n}\n\npublic class EfUnitOfWork : IUnitOfWork\n{\n    private readonly ShopDbContext db;\n    public EfUnitOfWork(ShopDbContext db) => this.db = db;\n    public void Commit() => db.SaveChanges();\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe8 ",(0,s.jsx)(n.strong,{children:"Questions for students"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Why does ",(0,s.jsx)(n.code,{children:"EfOrderRepository"})," implement an interface declared in Domain?"]}),"\n",(0,s.jsx)(n.li,{children:"What happens if tomorrow you switch from SQL Server to MongoDB?"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe6 ",(0,s.jsx)(n.strong,{children:"Practice"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Implement ",(0,s.jsx)(n.code,{children:"IPaymentGateway"})," abstraction in Application layer.\nProvide a fake gateway in tests and a real one in Infrastructure."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"-apiui-layer--the-window",children:["\ud83d\udd39 API\xa0/\xa0UI Layer \u2014 ",(0,s.jsx)(n.em,{children:"The Window"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Translate transport (HTTP/JSON, gRPC, GUI) into Application commands and queries."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'[ApiController]\n[Route("api/orders")]\npublic class OrdersController : ControllerBase\n{\n    private readonly PlaceOrderHandler handler;\n    public OrdersController(PlaceOrderHandler handler) => this.handler = handler;\n\n    [HttpPost("{id}/items")]\n    public IActionResult AddItem(int id, [FromBody] AddItemDto dto)\n    {\n        handler.Handle(new PlaceOrderCommand(id, dto.Price));\n        return Ok();\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rule of Thumb:"})," Controllers should contain ",(0,s.jsx)(n.em,{children:"zero"})," business logic."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe8 ",(0,s.jsx)(n.strong,{children:"Questions for students"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Where should input validation live: API or Application? Why?"}),"\n",(0,s.jsx)(n.li,{children:"If authentication rules change, which layer adapts?"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["\ud83d\udfe6 ",(0,s.jsx)(n.strong,{children:"Practice"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Add a ",(0,s.jsx)(n.code,{children:"GET /api/orders/{id}"})," endpoint. Map it to ",(0,s.jsx)(n.code,{children:"GetOrderByIdQuery"})," without exposing EF entities to the client."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-putting-it-all-together--request-flow",children:"\ud83d\udd39 Putting It All Together \u2014 Request Flow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"HTTP Request"})," hits ",(0,s.jsx)(n.code,{children:"OrdersController"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Controller converts JSON \u2192 ",(0,s.jsx)(n.code,{children:"PlaceOrderCommand"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Application handler calls Domain methods (",(0,s.jsx)(n.code,{children:"AddItem"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Handler invokes repositories (Infrastructure) and ",(0,s.jsx)(n.code,{children:"UnitOfWork"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Response DTO mapped back and returned to client."}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"API \u2192 Application \u2192 Domain \u2194 Infrastructure \u2192 DB"})})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"dependency-rule",children:"Dependency Rule"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Source\u2011code dependencies ",(0,s.jsx)(n.strong,{children:"always point inward"}),": API\u202f\u2192\u202fApplication\u202f\u2192\u202fDomain.",(0,s.jsx)(n.br,{}),"\n","Infrastructure depends on Domain abstractions, ",(0,s.jsx)(n.strong,{children:"never the reverse"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-clean-architecture-tips",children:"\ud83e\uddf9 Clean Architecture Tips"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Domain has no external references"})," \u2014 compile it in a standalone project."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Infrastructure can depend on any library"}),", but only implements interfaces from above."]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Application layer contains no EF, no SMTP, no HTTP."})}),"\n",(0,s.jsxs)(n.li,{children:["API is ",(0,s.jsx)(n.em,{children:"thin"}),": mapping + authentication/authorization."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>d});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);